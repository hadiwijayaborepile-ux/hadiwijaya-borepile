---
import { SEO } from 'astro-seo';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { ViewTransitions } from 'astro:transitions';

interface Props {
	title: string;
  description?: string;
  keywords?: string[];
}

const { 
  title = 'Hadiwijaya Pondasi Persada - Jasa Bore Pile Profesional',
  description = 'Solusi fondasi bore pile terpercaya untuk semua skala proyek. Kami menyediakan jasa bore pile manual, mini crane, dan hydraulic dengan tim berpengalaman.', 
  keywords = ['jasa bore pile', 'fondasi bore pile', 'kontraktor fondasi', 'bore pile jakarta', 'bore pile indonesia', 'bore pile manual', 'bore pile mini crane', 'bore pile hydraulic']
} = Astro.props;
---

<!doctype html>
<html lang="id">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/x-icon" href="/favicon.ico" />
		<meta name="generator" content={Astro.generator} />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css" />
    <link rel="stylesheet" href="/styles/animations.css" />

    <SEO
      title={title}
      description={description}
      keywords={keywords}
      openGraph={{
        basic: {
          title: title,
          type: 'website',
          image: '/assets/img/og-image.jpg', 
          url: Astro.url,
        }
      }}
      extend={{
        meta: [{ name: 'twitter:card', content: 'summary_large_image' }],
        link: [{ rel: 'canonical', href: Astro.url.href }]
      }}
    />
		<ViewTransitions />
	</head>
	<body>

		<Header/>
		<slot name="hero" />
		<main> 
			<slot/>
		</main>
		<Footer />

    <!-- Modal Form -->
    <div id="booking-modal" class="modal">
      <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2>Pesan Layanan</h2>
        <p>Lengkapi detail di bawah ini untuk membuat pesan WhatsApp.</p>
        <form id="booking-form">
          <div class="form-group">
            <label for="modal-name">Nama Anda</label>
            <input type="text" id="modal-name" name="name" required placeholder="Masukkan nama lengkap Anda">
          </div>
          <div class="form-group">
            <label for="modal-address">Alamat Proyek</label>
            <input type="text" id="modal-address" name="address" required placeholder="Contoh: Jl. Proyek No. 1, Jakarta">
          </div>
          <div class="form-group">
            <label for="modal-phone">Nomor Telepon (WhatsApp)</label>
            <input type="tel" id="modal-phone" name="phone" required placeholder="Contoh: 08123456789">
          </div>
          <button type="submit" class="cta-button"><i class="fab fa-whatsapp"></i> Kirim via WhatsApp</button>
        </form>
      </div>
    </div>

    <a href="https://wa.me/6281325794818" target="_blank" class="whatsapp-float" aria-label="WhatsApp">
        <i class="fab fa-whatsapp"></i>
    </a>
    
    <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>

    <!-- SCRIPT GLOBAL VERSI FINAL, LENGKAP, DAN UTUH -->
    <script is:inline>
      function initAll() {
        initNavbar();
        initStickyHeader();
        initFaq();
        initBookingModal();
        initFancybox();
      }

      function initNavbar() {
        const toggleButton = document.getElementById('mobile-menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
        if (toggleButton && mobileMenu && !toggleButton.dataset.listenerAttached) {
          toggleButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('mobile-menu-hidden');
          });
          toggleButton.dataset.listenerAttached = 'true';
        }
      }

      function initStickyHeader() {
        const header = document.getElementById('main-header');
        if (!header) return;
        const handleScroll = () => {
          if (window.scrollY > 40) header.classList.add('scrolled');
          else header.classList.remove('scrolled');
        };
        handleScroll();
        if (!window.scrollListenerAttached) {
            window.addEventListener('scroll', handleScroll);
            window.scrollListenerAttached = true;
        }
      }

      function initFaq() {
        document.querySelectorAll('.accordion-item').forEach(item => {
          const header = item.querySelector('.accordion-header');
          if (header && !header.dataset.listenerAttached) {
            header.addEventListener('click', () => {
              const content = item.querySelector('.accordion-content');
              const icon = header.querySelector('.accordion-icon');
              const isOpen = item.classList.toggle('open');
              if (content) {
                content.style.maxHeight = isOpen ? content.scrollHeight + 'px' : '0';
              }
              if (icon) {
                icon.style.transform = isOpen ? 'rotate(180deg)' : 'rotate(0deg)';
              }
            });
            header.dataset.listenerAttached = 'true';
          }
        });
      }

      function initBookingModal() {
        const modal = document.getElementById("booking-modal");
        if (!modal) return;
        const form = document.getElementById("booking-form");
        const closeBtn = modal.querySelector(".close-button");
        if (!form || !closeBtn) return;
        const openModal = (serviceName) => {
          window.currentService = serviceName;
          modal.style.display = "flex";
        };
        const closeModal = () => modal.style.display = "none";
        document.querySelectorAll('[data-action="open-booking-modal"]').forEach(btn => {
          if (!btn.dataset.listenerAttached) {
            btn.addEventListener('click', () => openModal(btn.dataset.serviceName));
            btn.dataset.listenerAttached = 'true';
          }
        });
        if (!closeBtn.dataset.listenerAttached) {
          closeBtn.addEventListener('click', closeModal);
          closeBtn.dataset.listenerAttached = 'true';
        }
        if (!window.modalClickListenerAttached) {
          window.addEventListener('click', (event) => {
            if (event.target === modal) closeModal();
          });
          window.modalClickListenerAttached = true;
        }
        if (!form.dataset.listenerAttached) {
          form.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = form.querySelector("#modal-name").value;
            const address = form.querySelector("#modal-address").value;
            const phone = form.querySelector("#modal-phone").value;
            const service = window.currentService || 'Tidak spesifik';
            const message = `Halo, saya ingin memesan layanan.\n\n*Layanan:* ${service}\n*Nama:* ${name}\n*Alamat Proyek:* ${address}\n*Nomor Telepon:* ${phone}\n\nMohon informasinya. Terima kasih.`;
            const whatsappUrl = `https://wa.me/6281325794818?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            closeModal();
            form.reset();
          });
          form.dataset.listenerAttached = 'true';
        }
      }

      function initFancybox() {
        if (typeof Fancybox !== 'undefined') {
          Fancybox.destroy();
          Fancybox.bind("[data-fancybox]", { Toolbar: { display: ["close"] } });
        }
      }

      document.addEventListener('astro:page-load', initAll);
      initAll(); // Fallback for initial load

    </script>
	</body>
</html>

<style is:global>
	:root {
		--primary-color: #FF6B00;
		--secondary-color: #222A7A;
		--background-color: #f8f9fa;
		--text-color: #333;
    --fancybox-bg: rgba(34, 42, 122, 0.92);
    --fancybox-toolbar-color: #fff;
    --fancybox-toolbar-bg: transparent;
	}
	html {
		font-family: system-ui, sans-serif;
		background: var(--background-color);
    scroll-behavior: smooth;
	}
	body {
		margin: 0;
		overflow-x: hidden;
	}
	main { position: relative; }
  .container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; }
  section { padding: 5rem 0; }
  section h2 { font-size: 2.8rem; color: var(--secondary-color); margin-bottom: 3rem; text-align: center; }
  .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
  .modal-content { position: relative; background-color: #fefefe; padding: 2.5rem; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.25); width: 90%; max-width: 500px; animation: slide-down 0.4s ease-out; }
  @keyframes slide-down { from { transform: translateY(-30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  .close-button { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; }
  .modal-content h2 { margin-top: 0; font-size: 2rem; text-align: left; }
  #booking-form .form-group { margin-bottom: 1.2rem; }
  #booking-form label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #444; text-align: left; }
  #booking-form input { width: 100%; padding: 0.8rem 1rem; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
  #booking-form .cta-button { display: inline-flex; align-items: center; justify-content: center; gap: 0.75rem; width: 100%; padding: 1rem; font-size: 1.1rem; margin-top: 1rem; border: none; cursor: pointer; border-radius: 8px; font-weight: 700; background-color: var(--primary-color); color: white; transition: background-color 0.3s, transform 0.2s; }
  #booking-form .cta-button:hover { background-color: #e65200; transform: translateY(-2px); }
  #booking-form .cta-button i { font-size: 1.2rem; }
  .whatsapp-float { position: fixed; width: 60px; height: 60px; bottom: 40px; right: 40px; background-color: #25D366; color: #FFF; border-radius: 50px; text-align: center; font-size: 38px; z-index: 1000; display: flex; align-items: center; justify-content: center; text-decoration: none; }
</style>