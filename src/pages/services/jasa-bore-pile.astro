---
import Layout from '../../layouts/Layout.astro';
import ServiceCard from '../../components/ServiceCard.astro';
import ProductCard from '../../components/ProductCard.astro';
import PageHero from '../../components/PageHero.astro';
import '../../styles/services-jasa-bore-pile.css';

const title = "Layanan Jasa Bore Pile: Manual, Mini Crane & Hydraulic | Hadiwijaya";
const description = "Hadiwijaya Pondasi Persada menyediakan layanan jasa bore pile lengkap: manual untuk akses terbatas, mini crane untuk efisiensi, dan hydraulic untuk proyek besar. Temukan metode pondasi yang tepat untuk Anda.";
const keywords = ["jasa bore pile", "layanan bore pile", "metode bore pile", "perbandingan bore pile", "bore pile manual", "bore pile mini crane", "bore pile hydraulic", "strauss pile", "solusi pondasi", "kontraktor bore pile", "jenis pondasi bore pile"];

const services = [
  {
    title: 'Bore Pile Manual',
    description: 'Presisi di ruang terbatas, solusi ideal untuk akses sulit.',
    href: '/services/manual',
    imgSrc: '/assets/img/gallery/3.jpg'
  },
  {
    title: 'Bore Pile Mini Crane',
    description: 'Efisiensi mesin untuk proyek skala menengah.',
    href: '/services/mini-crane',
    imgSrc: '/assets/img/gallery/1.jpg'
  },
  {
    title: 'Bore Pile Hydraulic',
    description: 'Kekuatan maksimal untuk proyek skala besar dan infrastruktur.',
    href: '/services/hydraulic',
    imgSrc: '/assets/img/gallery/4.png'
  }
];

// --- WooCommerce / Ecommerce features (uses env vars from .env; do not modify .env) ---
const WOOCOMMERCE_API_URL = import.meta.env.WOOCOMMERCE_API_URL;
const WOOCOMMERCE_CONSUMER_KEY = import.meta.env.WOOCOMMERCE_CONSUMER_KEY;
const WOOCOMMERCE_CONSUMER_SECRET = import.meta.env.WOOCOMMERCE_CONSUMER_SECRET;

let wcProducts = [];
if (WOOCOMMERCE_API_URL && WOOCOMMERCE_CONSUMER_KEY && WOOCOMMERCE_CONSUMER_SECRET) {
  try {
    try {
      const proxyRes = await fetch('/api/woo.json?page=1&per_page=12');
      if (proxyRes.ok) {
        wcProducts = await proxyRes.json();
      } else {
        throw new Error('proxy_failed');
      }
    } catch (proxyErr) {
      const base = WOOCOMMERCE_API_URL.replace(/\/+$/, '');
      const endpoint = `${base}/products?per_page=12&consumer_key=${WOOCOMMERCE_CONSUMER_KEY}&consumer_secret=${WOOCOMMERCE_CONSUMER_SECRET}`;
      const res = await fetch(endpoint);
      if (res.ok) wcProducts = await res.json();
      else console.error('WOO_ERROR: Failed to fetch products', res.status, await res.text());
    }
  } catch (err) {
    console.error('WOO_ERROR: Exception fetching products', err);
  }
} else {
  // environment missing; leave wcProducts empty
}

// helper: format price to Indonesian Rupiah
const formatPrice = (val: any) => {
  const n = Number(val);
  if (!isFinite(n)) return 'Harga belum tersedia';
  return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(n);
}

---

<Layout title={title} description={description} keywords={keywords}>
  <div class="services-hub-page">

    <PageHero 
      title="Solusi Pondasi untuk Setiap Skala"
      subtitle="Dari renovasi rumah di gang sempit hingga pembangunan gedung pencakar langit, kami memiliki metode bore pile yang tepat untuk menjamin kesuksesan proyek Anda."
    />

    <!-- Services Showcase -->
    <section class="showcase">
      <div class="container">
        <div class="showcase-grid">
          {services.map((s) => (
            <ServiceCard service={s} />
          ))}
        </div>
      </div>
    </section>

    <!-- Comparison Section -->
    <section class="comparison">
      <div class="container">
        <h2>Metode Mana yang Tepat untuk Anda?</h2>
        <div class="comparison-table-wrapper">
          <table class="comparison-table">
            <thead>
              <tr>
                <th>Kriteria</th>
                <th>Manual</th>
                <th>Mini Crane</th>
                <th>Hydraulic</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><i class="fas fa-road"></i> Akses Lokasi</td>
                <td>Sangat Sempit</td>
                <td>Cukup Luas</td>
                <td>Sangat Luas</td>
              </tr>
              <tr>
                <td><i class="fas fa-bolt"></i> Kecepatan</td>
                <td>Standar</td>
                <td>Cepat</td>
                <td>Superior</td>
              </tr>
              <tr>
                <td><i class="fas fa-weight-hanging"></i> Kekuatan</td>
                <td>Standar</td>
                <td>Tinggi</td>
                <td>Maksimal</td>
              </tr>
              <tr>
                <td><i class="fas fa-building"></i> Skala Proyek</td>
                <td>Kecil</td>
                <td>Menengah</td>
                <td>Besar & Masif</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- E-commerce Features -->
    <section class="ecom-features">
      <div class="container">
        <h2>Fitur Ecommerce â€” Produk Terkait</h2>
        <p class="lead">Berikut produk dan layanan yang tersedia melalui toko online kami. Data diambil dari WooCommerce.</p>

        {wcProducts.length === 0 ? (
          <p class="muted">Tidak ada produk yang tersedia atau koneksi ke API belum diatur.</p>
        ) : (
          <div class="products-grid">
            {wcProducts.map((p: any) => (
              <ProductCard product={p} />
            ))}
          </div>
        )}

      </div>
    </section>

    <!-- Final CTA -->
    <section class="final-cta">
      <div class="container">
        <h2>Punya Pertanyaan atau Proyek Spesifik?</h2>
        <p>Setiap proyek unik. Tim ahli kami siap membantu Anda memilih metode yang paling efisien dan efektif dari segi biaya untuk kebutuhan konstruksi Anda.</p>
        <a href="/contact" class="cta-button">Konsultasi Gratis</a>
      </div>
    </section>

  </div>
</Layout>

<!-- styles are in src/styles/services-jasa-bore-pile.css -->
