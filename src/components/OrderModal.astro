---
const phone = '6281233624549'; // WhatsApp number in international format (no plus)
---

<div id="order-modal" class="order-modal" aria-hidden="true" data-destination-phone={phone}>
  <div class="order-modal-backdrop" data-dismiss></div>
  <div class="order-modal-panel" role="dialog" aria-modal="true">
    <button class="order-modal-close" type="button" aria-label="Tutup" data-dismiss>Ã—</button>
    <h3>Pesan Sekarang</h3>
    <form id="order-form" class="order-form">
      <input type="hidden" name="product_name" id="product_name" />
      <div class="field">
        <label for="name">Nama</label>
        <input id="name" name="name" required />
      </div>
      <div class="field">
        <label for="phone">Nomor Telepon</label>
        <input id="phone" name="phone" required placeholder="08123456789" />
      </div>
      <div class="field">
        <label for="address">Alamat</label>
        <textarea id="address" name="address" rows="3"></textarea>
      </div>
      <div style="display:flex;gap:.5rem;justify-content:flex-end;margin-top:1rem;">
        <button type="button" class="btn btn-ghost order-cancel" data-dismiss>Batal</button>
        <button type="submit" class="btn btn-primary">Kirim via WhatsApp</button>
      </div>
    </form>
  </div>
</div>

<script>
// @ts-nocheck
// Helper to open/close modal
function openModal(productName) {
  const modal = document.getElementById('order-modal');
  if (!modal) return;
  modal.setAttribute('aria-hidden', 'false');
  const input = document.getElementById('product_name');
  if (input) input.value = productName || '';
  setTimeout(() => document.getElementById('name')?.focus(), 50);
}

function closeModal() {
  const modal = document.getElementById('order-modal');
  if (!modal) return;
  modal.setAttribute('aria-hidden', 'true');
  const form = document.getElementById('order-form');
  form && form.reset();
}

document.addEventListener('click', (e) => {
  const btn = e.target.closest && e.target.closest('.order-now');
  if (btn) {
    openModal(btn.getAttribute('data-name') || 'Produk');
    return;
  }

  if (e.target.matches('[data-dismiss]')) {
    closeModal();
  }
});

// Form submit: validate and redirect to WhatsApp URL with the helper phone constant above
const orderForm = document.getElementById('order-form');
if (orderForm) {
  orderForm.addEventListener('submit', (ev) => {
    ev.preventDefault();
    const form = ev.currentTarget as HTMLFormElement;
    const productEl = form.querySelector('#product_name') as HTMLInputElement | null;
    const nameEl = form.querySelector('#name') as HTMLInputElement | null;
    const phoneEl = form.querySelector('#phone') as HTMLInputElement | null;
    const addressEl = form.querySelector('#address') as HTMLTextAreaElement | null;
    const product = productEl ? productEl.value : '';
    const name = nameEl ? nameEl.value.trim() : '';
    let phoneVal = phoneEl ? phoneEl.value.trim() : '';
    const address = addressEl ? addressEl.value.trim() : '';

    if (!name) { alert('Nama wajib diisi'); return; }
    if (!phoneVal) { alert('Nomor telepon wajib diisi'); return; }

    const digits = phoneVal.replace(/\D+/g, '');
    if (!digits) { alert('Nomor telepon tidak valid'); return; }
    if (digits.startsWith('0')) phoneVal = '62' + digits.slice(1);
    else phoneVal = digits;

    const message = `Halo, saya ingin memesan: ${product}\nNama: ${name}\nNo: ${phoneVal}\nAlamat: ${address}`;
    const modal = document.getElementById('order-modal');
    const dest = modal?.dataset?.destinationPhone || phone;
    window.location.href = `https://wa.me/${dest}?text=${encodeURIComponent(message)}`;
  });
}
</script>
</script>
