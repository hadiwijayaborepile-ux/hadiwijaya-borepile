---
const API_BASE_URL = import.meta.env.API_URL;

let faqs = [];

if (API_BASE_URL) {
  try {
    const apiUrl = `${API_BASE_URL}/api/v2/faqs`;
    const response = await fetch(apiUrl, { cache: 'no-store' });

    if (response.ok) {
      const apiFaqs = await response.json();
      if (Array.isArray(apiFaqs) && apiFaqs.length > 0) {
        faqs = apiFaqs;
      }
    } else {
      console.error(`[Faq Component] API request failed: ${response.status}. Section will be empty.`);
    }
  } catch (error) {
    if (error instanceof Error) {
      console.error("[Faq Component] Gagal fetch data FAQ: " + error.message + ". Section will be empty.");
    } else {
      console.error("[Faq Component] Terjadi error tidak diketahui. Section will be empty.", error);
    }
  }
}
---

<section id="faq" class="faq-section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Frequently Asked Questions</h2>
      <p class="section-subtitle">Menemukan jawaban cepat untuk pertanyaan umum tentang layanan kami.</p>
    </div>
    <div class="faq-accordion">
      {faqs.map((faq, index) => (
        <details class="faq-item">
          <summary class="faq-question">
            <span>{faq.question}</span>
            <i class="fas fa-chevron-down faq-icon"></i>
          </summary>
          <div class="faq-answer">
            <p>{faq.answer}</p>
          </div>
        </details>
      ))}
    </div>
  </div>
</section>

<style>
  .faq-section { padding: 80px 0; background-color: #f8f9fa; }
  .section-header { text-align: center; margin-bottom: 50px; }
  .section-title { font-size: 2.5rem; font-weight: 700; color: var(--secondary-color); margin-bottom: 10px; }
  .section-subtitle { font-size: 1.1rem; color: #6c757d; max-width: 600px; margin: 0 auto; }
  .faq-accordion { max-width: 800px; margin: 0 auto; }

  .faq-item { 
    border-bottom: 1px solid #e0e0e0; 
    background: #fff; 
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1px solid #e0e0e0;
    overflow: hidden;
  }

  .faq-question { 
    width: 100%; 
    padding: 20px; 
    background: #fff; 
    text-align: left; 
    font-size: 1.1rem; 
    font-weight: 600; 
    cursor: pointer; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    color: var(--secondary-color); 
    list-style: none; /* Hide default marker */
  }

  .faq-question::-webkit-details-marker { display: none; } /* Hide default marker for Chrome/Safari */

  .faq-question:hover { background-color: #fdf2e9; }

  .faq-icon { 
  }

  /* Rotate icon when the <details> element is open */
  details[open] > .faq-question .faq-icon {
    transform: rotate(180deg);
  }

  .faq-answer { 
    background: #fff; 
    padding: 0 20px 20px 20px;
  }

  .faq-answer p { 
    margin: 0; 
    color: #555; 
    line-height: 1.6; 
  }

  @media (max-width: 768px) {
    .section-title {
      font-size: 1.8rem;
      font-weight: 700;
    }
  }
</style>