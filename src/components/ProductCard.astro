---
const { product } = Astro.props;

// Helper to format price to Indonesian Rupiah
const formatPrice = (val: any) => {
  const n = Number(val);
  if (!isFinite(n) || n === 0) return 'Harga tersedia via inquiry';
  return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(n);
}

// Safely get the image URL
const imageUrl = (product.images && product.images.length > 0) 
  ? product.images[0] 
  : '/assets/img/default-product.png'; // Fallback image

// Sanitize description: remove HTML and limit length
let description = product.short_description || product.description || '';
description = description.replace(/<[^>]*>?/gm, '').substring(0, 80) + '...';

// Build the internal link using the product slug
const productUrl = `/jasa/${product.slug}`;
---

<div class="product-card">
  <div class="card-image-wrapper">
    <img src={imageUrl} alt={product.name} class="product-image" loading="lazy" />
  </div>
  <div class="card-content">
    <h4>{product.name}</h4>
    <p class="product-price">{formatPrice(product.price)}</p>
    <p class="product-desc">{description}</p>
    <div class="card-actions">
      <a href={productUrl} class="btn btn-secondary">Lihat Produk</a>
    </div>
  </div>
</div>

<style>
  .product-card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.07);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px rgba(0,0,0,0.1);
  }

  .card-image-wrapper {
    width: 100%;
    padding-top: 125%; /* Aspect ratio 4:5 (portrait) */
    position: relative;
    background-color: #f0f0f0;
  }

  .product-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .card-content {
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }

  h4 {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--secondary-color);
    margin: 0 0 0.5rem;
    line-height: 1.4;
  }

  .product-price {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 0.75rem;
  }

  .product-desc {
    font-size: 0.95rem;
    color: #555;
    line-height: 1.6;
    flex-grow: 1;
    margin-bottom: 1.5rem;
  }

  .card-actions {
    margin-top: auto;
    display: grid;
    grid-template-columns: 1fr; /* DIUBAH: Hanya satu kolom */
    gap: 0.75rem;
  }

  .btn {
    padding: 0.75rem 1rem;
    border: 1px solid transparent;
    border-radius: 8px;
    text-align: center;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.2s ease;
    width: 100%;
  }

  .btn-primary {
    background-color: var(--primary-color);
    color: white;
  }
  .btn-primary:hover {
    background-color: var(--secondary-color);
  }

  .btn-secondary {
    background-color: #f0f0f0;
    color: #333;
  }
  .btn-secondary:hover {
    background-color: #e0e0e0;
  }
</style>
